"use strict";(()=>{var Q="[a-zA-Z_$]+",ve=Q+"[0-9a-zA-Z_$.]*";function b(t,e,r,n=!0){let s=n?ve:Q;return new RegExp(`(?<whole>\\${t}(?<${e}>${s})${r})`,"g")}var X={name:"ref",pluginType:"preprocessor",regexp:b("~","ref","",!1),replacer({ref:t}){return`document.querySelector(ctx.store()._dsPlugins.refs.${t})`}};var ee={pluginType:"attribute",prefix:"computed",mustNotEmptyKey:!0,onLoad:t=>{let e=t.store();return e[t.key]=t.reactivity.computed(()=>t.expressionFn(t)),()=>{let r=t.store();delete r[t.key]}}};function k(t){if(!t)return"null";if(typeof t=="string")return t;if(t instanceof Window)return"Window";if(t instanceof Document)return"Document";if(t.tagName==="BODY")return"BODY";let e=new Array;for(;t.parentElement&&t.tagName!=="BODY";){if(t.id){let r=t.getAttribute("id");if(!r)throw new Error("Element has an ID but no ID attribute");e.unshift("#"+r);break}else{let r=1,n=t;for(;n.previousElementSibling;n=n.previousElementSibling,r++);e.unshift(t.tagName+":nth-child("+r+")")}t=t.parentElement}return e.join(">")}function te(t){return t instanceof HTMLElement||t instanceof SVGElement?t:null}var re={pluginType:"attribute",prefix:"ref",mustHaveEmptyKey:!0,mustNotEmptyExpression:!0,bypassExpressionFunctionCreation:()=>!0,onLoad:t=>{t.upsertIfMissingFromStore("_dsPlugins.refs",{});let{el:e,expression:r}=t,s={_dsPlugins:{refs:{...t.store()._dsPlugins.refs.value,[r]:k(e)}}};return t.mergeStore(s),()=>{let i=t.store(),o={...i._dsPlugins.refs.value};delete o[r],i._dsPlugins.refs=o}}};function ne(t,e,r){let n={};if(!r)Object.assign(n,e);else for(let s in e){let i=t[s]?.value;i==null&&(n[s]=e[s])}return n}var se={pluginType:"attribute",prefix:"store",removeNewLines:!0,preprocessors:{pre:[{pluginType:"preprocessor",name:"store",regexp:/(?<whole>.+)/g,replacer:t=>{let{whole:e}=t;return`Object.assign({...ctx.store()}, ${e})`}}]},allowedModifiers:new Set(["local","session","ifmissing"]),onLoad:t=>{let e="",r=u=>{let m=t.store(),p=JSON.stringify(m);p!==e&&(window.localStorage.setItem(x,p),e=p)},n=t.modifiers.has("local");if(n){window.addEventListener(v,r);let u=window.localStorage.getItem(x)||"{}",m=JSON.parse(u);t.mergeStore(m)}let s=t.modifiers.has("session"),i=u=>{let m=t.store(),p=JSON.stringify(m);window.sessionStorage.setItem(x,p)};if(s){window.addEventListener(v,i);let u=window.sessionStorage.getItem(x)||"{}",m=JSON.parse(u);t.mergeStore(m)}let o=t.expressionFn(t),c=ne(t.store(),o,t.modifiers.has("ifmissing"));return t.mergeStore(c),delete t.el.dataset[t.rawKey],()=>{n&&window.removeEventListener(v,r),s&&window.removeEventListener(v,i)}}};var oe={name:"action",pluginType:"preprocessor",regexp:b("$\\$","action","(?<call>\\((?<args>.*)\\))?"),replacer:({action:t,args:e})=>{let r=["ctx"];e&&r.push(...e.split(",").map(s=>s.trim()));let n=r.join(",");return`ctx.actions.${t}(${n})`}};var ie={name:"signal",pluginType:"preprocessor",regexp:b("$","signal","(?<method>\\([^\\)]*\\))?"),replacer:t=>{let{signal:e,method:r}=t,n="ctx.store()";if(!r?.length)return`${n}.${e}.value`;let s=e.split("."),i=s.pop(),o=s.join(".");return`${n}.${o}.value.${i}${r}`}};var Se=Symbol.for("preact-signals"),h=1,E=2,R=4,T=8,L=16,w=32;function C(){P++}function j(){if(P>1){P--;return}let t,e=!1;for(;D!==void 0;){let r=D;for(D=void 0,V++;r!==void 0;){let n=r._nextBatchedEffect;if(r._nextBatchedEffect=void 0,r._flags&=~E,!(r._flags&T)&&ue(r))try{r._callback()}catch(s){e||(t=s,e=!0)}r=n}}if(V=0,P--,e)throw t}function ae(t){if(P>0)return t();C();try{return t()}finally{j()}}var a;var D,P=0,V=0,$=0;function le(t){if(a===void 0)return;let e=t._node;if(e===void 0||e._target!==a)return e={_version:0,_source:t,_prevSource:a._sources,_nextSource:void 0,_target:a,_prevTarget:void 0,_nextTarget:void 0,_rollbackNode:e},a._sources!==void 0&&(a._sources._nextSource=e),a._sources=e,t._node=e,a._flags&w&&t._subscribe(e),e;if(e._version===-1)return e._version=0,e._nextSource!==void 0&&(e._nextSource._prevSource=e._prevSource,e._prevSource!==void 0&&(e._prevSource._nextSource=e._nextSource),e._prevSource=a._sources,e._nextSource=void 0,a._sources._nextSource=e,a._sources=e),e}function f(t){this._value=t,this._version=0,this._node=void 0,this._targets=void 0}f.prototype.brand=Se;f.prototype._refresh=function(){return!0};f.prototype._subscribe=function(t){this._targets!==t&&t._prevTarget===void 0&&(t._nextTarget=this._targets,this._targets!==void 0&&(this._targets._prevTarget=t),this._targets=t)};f.prototype._unsubscribe=function(t){if(this._targets!==void 0){let e=t._prevTarget,r=t._nextTarget;e!==void 0&&(e._nextTarget=r,t._prevTarget=void 0),r!==void 0&&(r._prevTarget=e,t._nextTarget=void 0),t===this._targets&&(this._targets=r)}};f.prototype.subscribe=function(t){return B(()=>{let e=this.value,r=a;a=void 0;try{t(e)}finally{a=r}})};f.prototype.valueOf=function(){return this.value};f.prototype.toString=function(){return this.value+""};f.prototype.toJSON=function(){return this.value};f.prototype.peek=function(){let t=a;a=void 0;try{return this.value}finally{a=t}};Object.defineProperty(f.prototype,"value",{get(){let t=le(this);return t!==void 0&&(t._version=this._version),this._value},set(t){if(t!==this._value){if(V>100)throw new Error("Cycle detected");this._value=t,this._version++,$++,C();try{for(let e=this._targets;e!==void 0;e=e._nextTarget)e._target._notify()}finally{j()}}}});function M(t){return new f(t)}function ue(t){for(let e=t._sources;e!==void 0;e=e._nextSource)if(e._source._version!==e._version||!e._source._refresh()||e._source._version!==e._version)return!0;return!1}function fe(t){for(let e=t._sources;e!==void 0;e=e._nextSource){let r=e._source._node;if(r!==void 0&&(e._rollbackNode=r),e._source._node=e,e._version=-1,e._nextSource===void 0){t._sources=e;break}}}function ce(t){let e=t._sources,r;for(;e!==void 0;){let n=e._prevSource;e._version===-1?(e._source._unsubscribe(e),n!==void 0&&(n._nextSource=e._nextSource),e._nextSource!==void 0&&(e._nextSource._prevSource=n)):r=e,e._source._node=e._rollbackNode,e._rollbackNode!==void 0&&(e._rollbackNode=void 0),e=n}t._sources=r}function S(t){f.call(this,void 0),this._fn=t,this._sources=void 0,this._globalVersion=$-1,this._flags=R}S.prototype=new f;S.prototype._refresh=function(){if(this._flags&=~E,this._flags&h)return!1;if((this._flags&(R|w))===w||(this._flags&=~R,this._globalVersion===$))return!0;if(this._globalVersion=$,this._flags|=h,this._version>0&&!ue(this))return this._flags&=~h,!0;let t=a;try{fe(this),a=this;let e=this._fn();(this._flags&L||this._value!==e||this._version===0)&&(this._value=e,this._flags&=~L,this._version++)}catch(e){this._value=e,this._flags|=L,this._version++}return a=t,ce(this),this._flags&=~h,!0};S.prototype._subscribe=function(t){if(this._targets===void 0){this._flags|=R|w;for(let e=this._sources;e!==void 0;e=e._nextSource)e._source._subscribe(e)}f.prototype._subscribe.call(this,t)};S.prototype._unsubscribe=function(t){if(this._targets!==void 0&&(f.prototype._unsubscribe.call(this,t),this._targets===void 0)){this._flags&=~w;for(let e=this._sources;e!==void 0;e=e._nextSource)e._source._unsubscribe(e)}};S.prototype._notify=function(){if(!(this._flags&E)){this._flags|=R|E;for(let t=this._targets;t!==void 0;t=t._nextTarget)t._target._notify()}};Object.defineProperty(S.prototype,"value",{get(){if(this._flags&h)throw new Error("Cycle detected");let t=le(this);if(this._refresh(),t!==void 0&&(t._version=this._version),this._flags&L)throw this._value;return this._value}});function pe(t){return new S(t)}function de(t){let e=t._cleanup;if(t._cleanup=void 0,typeof e=="function"){C();let r=a;a=void 0;try{e()}catch(n){throw t._flags&=~h,t._flags|=T,G(t),n}finally{a=r,j()}}}function G(t){for(let e=t._sources;e!==void 0;e=e._nextSource)e._source._unsubscribe(e);t._fn=void 0,t._sources=void 0,de(t)}function be(t){if(a!==this)throw new Error("Out-of-order effect");ce(this),a=t,this._flags&=~h,this._flags&T&&G(this),j()}function O(t){this._fn=t,this._cleanup=void 0,this._sources=void 0,this._nextBatchedEffect=void 0,this._flags=w}O.prototype._callback=function(){let t=this._start();try{if(this._flags&T||this._fn===void 0)return;let e=this._fn();typeof e=="function"&&(this._cleanup=e)}finally{t()}};O.prototype._start=function(){if(this._flags&h)throw new Error("Cycle detected");this._flags|=h,this._flags&=~T,de(this),fe(this),C();let t=a;return a=this,be.bind(this,t)};O.prototype._notify=function(){this._flags&E||(this._flags|=E,this._nextBatchedEffect=D,D=this)};O.prototype._dispose=function(){this._flags|=T,this._flags&h||G(this)};function B(t){let e=new O(t);try{e._callback()}catch(r){throw e._dispose(),r}return e._dispose.bind(e)}var F=class{get value(){return J(this)}set value(e){ae(()=>xe(this,e))}peek(){return J(this,{peek:!0})}},A=t=>Object.assign(new F,Object.entries(t).reduce((e,[r,n])=>{if(["value","peek"].some(s=>s===r))throw new Error(`${r} is a reserved property name`);return typeof n!="object"||n===null||Array.isArray(n)?e[r]=M(n):e[r]=A(n),e},{})),xe=(t,e)=>Object.keys(e).forEach(r=>t[r].value=e[r]),J=(t,{peek:e=!1}={})=>Object.entries(t).reduce((r,[n,s])=>(s instanceof f?r[n]=e?s.peek():s.value:s instanceof F&&(r[n]=J(s,{peek:e})),r),{});function H(t,e){if(typeof e!="object"||Array.isArray(e)||!e)return JSON.parse(JSON.stringify(e));if(typeof e=="object"&&e.toJSON!==void 0&&typeof e.toJSON=="function")return e.toJSON();let r=t;return typeof t!="object"&&(r={...e}),Object.keys(e).forEach(n=>{r.hasOwnProperty(n)||(r[n]=e[n]),e[n]===null?delete r[n]:r[n]=H(r[n],e[n])}),r}var x="datastar",v=`${x}-event`;var I=class{constructor(){this.plugins=[];this.store=A({_dsPlugins:{}});this.preprocessors=new Array;this.actions={};this.refs={};this.reactivity={signal:M,computed:pe,effect:B};this.parentID="";this.missingIDNext=0;this.removals=new Map;this.mergeRemovals=new Array;new MutationObserver((r,n)=>{this.sendDatastarEvent("core","dom","mutation",document.body,document.body.outerHTML)}).observe(document.body,{attributes:!0,childList:!0,subtree:!0})}load(...e){e.forEach(r=>{switch(r.pluginType){case"preprocessor":if(this.plugins.find(o=>o.prefix===r.name))throw new Error(`Preprocessor ${r.name} already exists`);this.preprocessors.push(r);break;case"action":if(this.actions[r.name])throw new Error(`Action ${r.name} already exists`);if(window[r.name])throw new Error(`Action ${r.name} already exists globally`);this.actions[r.name]=r;break;case"attribute":let i=new Set(this.plugins.map(o=>o.prefix));if(r.requiredPluginPrefixes){for(let o of r.requiredPluginPrefixes)if(!i.has(o))throw new Error(`${r.prefix} requires ${o}`)}this.plugins.push(r),i.add(r.prefix),r.onGlobalInit&&(r.onGlobalInit({actions:this.actions,reactivity:this.reactivity,mergeStore:this.mergeStore.bind(this),store:this.store}),this.sendDatastarEvent("core","plugins","registration","BODY",`On prefix ${r.prefix}`));break}}),this.applyPlugins(document.body)}sendDatastarEvent(e,r,n,s,i,o={bubbles:!0,cancelable:!0,composed:!0}){window.dispatchEvent(new CustomEvent(v,Object.assign({detail:{time:new Date,category:e,subcategory:r,type:n,target:k(s),message:i}},o)))}cleanupElementRemovals(e){let r=this.removals.get(e);if(r){for(let n of r.set)n();this.removals.delete(e)}}mergeStore(e){this.mergeRemovals.forEach(n=>n()),this.mergeRemovals=this.mergeRemovals.slice(0);let r=H(this.store.value,e);this.store=A(r),this.mergeRemovals.push(this.reactivity.effect(()=>{this.sendDatastarEvent("core","store","merged","STORE",JSON.stringify(this.store.value))}))}removeFromStore(...e){let r={...this.store.value};for(let n of e){let s=n.split("."),i=s[0],o=r;for(let c=1;c<s.length;c++){let u=s[c];o[i]||(o[i]={}),o=o[i],i=u}delete o[i]}this.store=A(r),this.applyPlugins(document.body)}upsertIfMissingFromStore(e,r){let n=e.split("."),s=this.store;for(let o=0;o<n.length-1;o++){let c=n[o];s[c]||(s[c]={}),s=s[c]}let i=n[n.length-1];s[i]||(s[i]=this.reactivity.signal(r),this.sendDatastarEvent("core","store","upsert",e,r))}signalByName(e){return this.store[e]}applyPlugins(e){let r=new Set;this.plugins.forEach((n,s)=>{this.walkDownDOM(e,i=>{s||this.cleanupElementRemovals(i);for(let o in i.dataset){let c=`${i.dataset[o]}`||"",u=c;if(!o.startsWith(n.prefix))continue;if(i.id.length===0&&(i.id=`ds-${this.parentID}-${this.missingIDNext++}`),r.clear(),n.allowedTagRegexps){let l=i.tagName.toLowerCase();if(![...n.allowedTagRegexps].some(d=>l.match(d)))throw new Error(`'${i.tagName}' not allowed for '${o}', allowed ${[[...n.allowedTagRegexps].map(d=>`'${d}'`)].join(", ")}`)}let m=o.slice(n.prefix.length),[p,...me]=m.split(".");if(n.mustHaveEmptyKey&&p.length>0)throw new Error(`'${o}' must have empty key`);if(n.mustNotEmptyKey&&p.length===0)throw new Error(`'${o}' must have non-empty key`);p.length&&(p=p[0].toLowerCase()+p.slice(1));let K=me.map(l=>{let[y,...d]=l.split("_");return{label:y,args:d}});if(n.allowedModifiers){for(let l of K)if(!n.allowedModifiers.has(l.label))throw new Error(`'${l.label}' is not allowed`)}let U=new Map;for(let l of K)U.set(l.label,l.args);if(n.mustHaveEmptyExpression&&u.length)throw new Error(`'${o}' must have empty expression`);if(n.mustNotEmptyExpression&&!u.length)throw new Error(`'${o}' must have non-empty expression`);let W=/;|\n/;n.removeNewLines&&(u=u.split(`
`).map(l=>l.trim()).join(" "));let _e=[...n.preprocessors?.pre||[],...this.preprocessors,...n.preprocessors?.post||[]];for(let l of _e){if(r.has(l))continue;r.add(l);let y=u.split(W),d=[];y.forEach(g=>{let _=g,q=[..._.matchAll(l.regexp)];if(q.length)for(let z of q){if(!z.groups)continue;let{groups:Z}=z,{whole:ye}=Z;_=_.replace(ye,l.replacer(Z))}d.push(_)}),u=d.join("; ")}let N={store:()=>this.store,mergeStore:this.mergeStore.bind(this),upsertIfMissingFromStore:this.upsertIfMissingFromStore.bind(this),removeFromStore:this.removeFromStore.bind(this),applyPlugins:this.applyPlugins.bind(this),cleanupElementRemovals:this.cleanupElementRemovals.bind(this),walkSignals:this.walkSignals.bind(this),actions:this.actions,reactivity:this.reactivity,el:i,rawKey:o,key:p,rawExpression:c,expression:u,expressionFn:()=>{throw new Error("Expression function not created")},modifiers:U,sendDatastarEvent:this.sendDatastarEvent.bind(this)};if(!n.bypassExpressionFunctionCreation?.(N)&&!n.mustHaveEmptyExpression&&u.length){let l=u.split(W).map(g=>g.trim()).filter(g=>g.length);l[l.length-1]=`return ${l[l.length-1]}`;let y=l.map(g=>`  ${g}`).join(`;
`),d=`
  try {
    const _datastarExpression = () => {
  ${y}
    }
    const _datastarReturnVal = _datastarExpression()
    ctx.sendDatastarEvent('core', 'attributes', 'expr_eval', ctx.el, '${o} equals ' + JSON.stringify(_datastarReturnVal))
    return _datastarReturnVal
  } catch (e) {
   const msg = \`
  Error evaluating Datastar expression:
  ${y.replaceAll("`","\\`")}

  Error: \${e.message}

  Check if the expression is valid before raising an issue.
  \`.trim()
   ctx.sendDatastarEvent('core', 'attributes', 'expr_eval_err', ctx.el, msg)
   console.error(msg)
   debugger
  }
              `;try{let g=n.argumentNames||[],_=new Function("ctx",...g,d);N.expressionFn=_}catch(g){let _=new Error(`Error creating expression function for '${d}', error: ${g}`);this.sendDatastarEvent("core","attributes","expr_construction_err",N.el,String(_)),console.error(_);debugger}}let Y=n.onLoad(N);Y&&(this.removals.has(i)||this.removals.set(i,{id:i.id,set:new Set}),this.removals.get(i).set.add(Y))}})})}walkSignalsStore(e,r){let n=Object.keys(e);for(let s=0;s<n.length;s++){let i=n[s],o=e[i],c=o instanceof f,u=typeof o=="object"&&Object.keys(o).length>0;if(c){r(i,o);continue}u&&this.walkSignalsStore(o,r)}}walkSignals(e){this.walkSignalsStore(this.store,e)}walkDownDOM(e,r,n=0){if(!e)return;let s=te(e);if(s)for(r(s),n=0,e=e.firstElementChild;e;)this.walkDownDOM(e,r,n++),e=e.nextElementSibling}};var ge=new I;ge.load(oe,ie,X,se,ee,re);var he=ge;he.load();})();
//# sourceMappingURL=datastar-core.js.map
